generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id          Int                @id @default(autoincrement())
  nome        String             @db.VarChar(100)
  email       String             @unique @db.VarChar(100)
  senha       String             @db.VarChar(255)
  anotacoes   String?            @db.Text
  telefone    String?            @db.VarChar(20)
  status      StatusUsuario      @default(ativo)
  dataCriacao DateTime           @default(now())
  regra       Permissao
  Contas      Contas[]
  grupos      UsuariosOnGrupos[]
}

model UsuariosOnGrupos {
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  usuarioId Int
  grupo     Grupos   @relation(fields: [grupoId], references: [id])
  grupoId   Int
  createdAt DateTime @default(now())
  createBy  Int

  @@id([usuarioId, grupoId])
}

model Grupos {
  id         Int                  @id @default(autoincrement())
  grupo      String               @db.VarChar(100)
  createdAt  DateTime             @default(now())
  usuarios   UsuariosOnGrupos[]
  permissoes PermissoesOnGrupos[]
}

model PermissoesOnGrupos {
  grupoId     Int
  grupo       Grupos     @relation(fields: [grupoId], references: [id])
  permissaoId Int
  permissao   Permissoes @relation(fields: [permissaoId], references: [id])
  createdBy   Int
  createdAt   DateTime   @default(now())

  @@id([permissaoId, grupoId])
}

model Permissoes {
  id        Int                  @id @default(autoincrement())
  cor       String
  permissao String
  createdAt DateTime             @default(now())
  status    StatusUsuario
  Grupos    PermissoesOnGrupos[]
}

model Cliente {
  id           Int           @id @default(autoincrement())
  nome         String        @db.VarChar(100)
  email        String        @unique @db.VarChar(100)
  telefone     String?       @db.VarChar(20)
  endereco     String?       @db.Text
  dataCriacao  DateTime      @default(now())
  status       StatusUsuario @default(ativo)
  dataBloqueio DateTime?
  Assinatura   Assinatura[]
  Transacao    Transacao[]
  Bloqueio     Bloqueio[]
}

model Plano {
  id              Int          @id @default(autoincrement())
  nome            String       @db.VarChar(100)
  descricao       String?      @db.Text
  preco           Float
  cor             String
  dataCriacao     DateTime     @default(now())
  dataAtualizacao DateTime?
  Assinatura      Assinatura[]
}

model Assinatura {
  id         Int      @id @default(autoincrement())
  clienteId  Int
  planoId    Int
  dataInicio DateTime
  dataFim    DateTime
  status     Status   @default(ativa)
  createdAt  DateTime @default(now())
  Cliente    Cliente  @relation(fields: [clienteId], references: [id])
  Plano      Plano    @relation(fields: [planoId], references: [id])
}

model Transacao {
  id               Int               @id @default(autoincrement())
  clienteId        Int
  operacao         TipoOperacao
  natureza         NaturezaTransacao
  contaId          Int
  formaPagamentoId Int
  planoId          Int?
  servicoId        Int?
  categoriasId     Int
  parcelado        Parcelado         @default(nao)
  parcelamentoId   Int?              @default(0)
  data             DateTime
  valor            Float             @default(0)
  desconto         Float?            @default(0)
  valorFinal       Float             @default(0)
  dataEfetivado    DateTime?
  dataLancamento   DateTime          @default(now())
  status           StatusTransacao   @default(pendente)
  descricao        String?           @db.Text
  Cliente          Cliente           @relation(fields: [clienteId], references: [id])
  Conta            Contas            @relation(fields: [contaId], references: [id])
  FormaPagamento   FormasPagamento   @relation(fields: [formaPagamentoId], references: [id])
  Categoria        Categorias        @relation(fields: [categoriasId], references: [id])
  Parcelamento     Parcelamento[]
}

model Parcelas {
  id         Int             @id @default(autoincrement())
  nome       String
  quantidade Int             @default(1)
  periodo    PeriodoParcelas
}

model Configuracoes {
  id          Int      @id @default(autoincrement())
  chave       String
  valor       String
  dataCriacao DateTime @default(now())
}

model Parcelamento {
  id              Int             @id @default(autoincrement())
  transacaoId     Int
  parcela         Int
  status          StatusTransacao @default(pendente)
  valor           Float
  valorRecebido   Float?
  dataRecebimento DateTime?
  dataCadastro    DateTime        @default(now())
  Transacao       Transacao       @relation(fields: [transacaoId], references: [id], onDelete: Cascade)
}

model FormasPagamento {
  id        Int         @id @default(autoincrement())
  forma     String
  cor       String?
  Transacao Transacao[]
}

model Categorias {
  id        Int         @id @default(autoincrement())
  categoria String
  cor       String
  Transacao Transacao[]
}

model Contas {
  id        Int         @id @default(autoincrement())
  conta     String      @db.VarChar(200)
  saldo     Float       @default(0)
  regra     Regra       @default(privada)
  userId    Int
  cor       String?
  descricao String      @db.Text
  transacao Transacao[]
  Usuario   Usuario     @relation(fields: [userId], references: [id])
}

model Bloqueio {
  id              Int       @id @default(autoincrement())
  clienteId       Int
  motivo          String    @db.Text
  dataBloqueio    DateTime
  dataDesbloqueio DateTime?
  Cliente         Cliente   @relation(fields: [clienteId], references: [id])
}

enum PeriodoParcelas {
  mensal
  semanal
  diario
  anual
}

enum Parcelado {
  sim
  nao
}

enum Status {
  ativa
  vencida
  cancelada
}

enum NaturezaTransacao {
  receita
  despesa
}

enum StatusTransacao {
  recebido
  pendente
}

enum Regra {
  publica
  privada
}

enum TipoOperacao {
  entrada
  saida
  transferencia
  ajuste
}

enum StatusUsuario {
  ativo
  inativo
}

enum Permissao {
  admin
  gerente
  moderador
  submoderador
  visualizador
}
